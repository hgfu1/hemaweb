<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ç”µå­ä»·ç­¾è“ç‰™æ§åˆ¶ä¸­å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 14px;
            }
            
            .container {
                border-radius: 15px;
                margin: 0;
            }
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
                margin-bottom: 8px;
            }
            
            .header p {
                font-size: 0.95em;
            }
        }

        .connection-panel {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            padding: 20px;
            margin: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .connection-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            min-height: 44px; /* ç¡®ä¿è§¦æ‘¸å‹å¥½çš„æœ€å°é«˜åº¦ */
        }

        @media (max-width: 768px) {
            .connection-panel {
                margin: 15px;
                padding: 15px;
            }
            
            .connection-buttons {
                gap: 10px;
                flex-direction: column;
            }
            
            .btn {
                padding: 15px 20px;
                font-size: 16px;
                min-height: 50px;
                width: 100%;
                border-radius: 12px;
            }
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            margin: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: #1976d2;
            transition: all 0.3s ease;
            position: relative;
            min-height: 44px;
        }

        @media (max-width: 768px) {
            .tabs {
                margin: 15px;
                flex-direction: column;
                border-radius: 12px;
            }
            
            .tab {
                padding: 15px;
                font-size: 15px;
                min-height: 50px;
                border-right: none !important;
            }
            
            .tab:not(:last-child) {
                border-bottom: 1px solid rgba(255,255,255,0.3);
            }
            
            .tab.active {
                transform: none;
                border-radius: 0;
            }
        }

        .tab:not(:last-child) {
            border-right: 1px solid rgba(255,255,255,0.3);
        }

        .tab.active {
            background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
            color: white;
            transform: scale(1.05);
            z-index: 2;
            box-shadow: 0 4px 15px rgba(25, 118, 210, 0.4);
        }

        .tab:hover:not(.active) {
            background: linear-gradient(135deg, #bbdefb 0%, #90caf9 100%);
            transform: translateY(-2px);
        }

        .content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 10px;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px 15px;
            }
            
            .card {
                padding: 20px;
                margin-bottom: 15px;
                border-radius: 12px;
            }
            
            .card:hover {
                transform: none;
            }
            
            .card-title {
                font-size: 1.2em;
                margin-bottom: 15px;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-control:focus {
            outline: none;
            border-color: #4facfe;
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .form-control-inline {
            display: inline-block;
            width: auto;
            margin-right: 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .form-control {
                padding: 15px 16px;
                font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
                border-radius: 8px;
            }
            
            .form-control-inline {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .button-group {
                flex-direction: column;
                gap: 8px;
            }
            
            .button-group .btn {
                width: 100%;
                margin: 0;
            }
        }

        .canvas-container {
            position: relative;
            display: inline-block;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        #canvas {
            border: 3px solid #4facfe;
            border-radius: 10px;
            background: white;
        }

        #edit-font {
            max-width: 296px;
            position: absolute;
            border: 2px solid #4facfe;
            background-color: rgba(255, 255, 255, 0.9);
            display: none;
            overflow: auto;
            border-radius: 5px;
            padding: 5px;
            backdrop-filter: blur(5px);
        }

        .log-container {
            margin: 20px;
            background: #2c3e50;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .log-header {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }

        #log {
            width: 100%;
            background: #1a252f;
            color: #00ff00;
            border: none;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            resize: vertical;
            min-height: 200px;
        }

        @media (max-width: 768px) {
            .canvas-container {
                width: 100%;
                max-width: 100%;
                border-radius: 8px;
            }
            
            #canvas {
                width: 100%;
                max-width: 100%;
                height: auto;
                border-width: 2px;
                border-radius: 8px;
            }
            
            #edit-font {
                max-width: 90%;
                border-radius: 8px;
            }
            
            .log-container {
                margin: 15px;
                border-radius: 12px;
            }
            
            .log-header {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            #log {
                padding: 15px;
                font-size: 11px;
                min-height: 150px;
            }
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: #27ae60;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        /* è¡¨æ ¼å“åº”å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        td, th {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        @media (max-width: 768px) {
            .feature-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            /* è¡¨æ ¼åœ¨ç§»åŠ¨ç«¯çš„å¤„ç† */
            table {
                font-size: 14px;
            }
            
            td, th {
                padding: 10px 6px;
                font-size: 13px;
            }
            
            /* è®©è¡¨æ ¼å¯ä»¥æ¨ªå‘æ»šåŠ¨ */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            /* å·¥å…·æç¤ºåœ¨ç§»åŠ¨ç«¯çš„ä¼˜åŒ– */
            .tooltip::after {
                font-size: 11px;
                padding: 6px 10px;
            }
        }

        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            vertical-align: middle;
        }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* ç§»åŠ¨ç«¯é¢å¤–ä¼˜åŒ– */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .btn {
                font-size: 15px;
                padding: 12px 16px;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script type="application/javascript" src="ç”µå­ä»·ç­¾è“ç‰™æ§åˆ¶å™¨_files/dithering.js"></script>
    <script type="application/javascript" src="ç”µå­ä»·ç­¾è“ç‰™æ§åˆ¶å™¨_files/utils.js"></script>
</head>

<body>
    <script>
        let bleDevice;
        let gattServer;
        let epdService;
        let rxtxService;
        let epdCharacteristic;
        let rxtxCharacteristic;
        let reconnectTrys = 0;

        function delay(delayInms) {
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(2);
                }, delayInms);
            });
        }

        // å­—ç¬¦ä¸²è¿›è¡Œgb2312ç¼–ç 
        function encodeToGb2312(str) {
            if (!str) {
                return '';
            }
            return urlEncode(strTrim(str));
        }

        // å°†16è¿›åˆ¶è½¬decodeç¼–ç 
        function hex2per(data) {
            if (data.length % 2) {
                console.error('16è¿›åˆ¶æ•°æ®æ ¼å¼é”™è¯¯');
                return '';
            };

            var tmp = [];

            for (let i = 0; i < data.length; i += 2) {
                tmp.push(data.charAt(i) + data.charAt(i + 1));
            }

            let str = tmp.join('%');

            return '%' + str;
        }

        // å­—ç¬¦ä¸²è¿›è¡Œgb2312è§£ç 
        function decodeCnGb2312(s) {
            var strChn = getChineseCode();
            var strOut = '';
            let str = hex2per(s);

            if (str) {
                for (var i = 0; i < str.length; i++) {
                    var c = str.charAt(i);
                    // +æ˜¯ç©ºæ ¼
                    if (c == '+') {
                        strOut += ' ';
                    }
                    // a,b,c,1,2ç­‰ï¼Œé%å¼€å¤´çš„ï¼Œç›´æ¥è¿”å›æœ¬èº«
                    else if (c != '%') {
                        strOut += c;
                    }
                    // %å¼€å¤´
                    else {
                        i++;
                        var nextC = str.charAt(i);
                        // æ•°å­—ï¼Œåˆ™ä¸æ˜¯æ±‰å­—
                        if (!isNaN(parseInt(nextC))) {
                            i++;
                            strOut += decodeURIComponent(c + nextC + str.charAt(i));
                        } else {
                            var x = new String();
                            try {
                                var code = str.substr(i, 2) + str.substr(i + 3, 2);
                                code = code.toUpperCase();
                                i = i + 4;

                                var index = -1;
                                while ((index = strChn.indexOf(code, index + 1)) != -1) {
                                    if (index % 4 == 0) {
                                        strOut += String.fromCharCode(index / 4 + 19968);
                                        break;
                                    }
                                }
                            } catch (e) {}
                        }
                    }
                }
            }
            return strOut;
        }

        function strTrim(str) {
            while (str.length > 0 && str.charAt(0) == ' ')
                str = str.substring(1, str.length);
            while (str.length > 0 && str.charAt(str.length - 1) == ' ')
                str = str.substring(0, str.length - 1);
            str = str.replace(' ', '+');
            return str;
        }

        function strReplace(str, a, b) {
            var i;
            var s2 = str;
            while (s2.indexOf(a) > 0) {
                i = s2.indexOf(a);
                s2 = s2.substring(0, i) + b + s2.substring(i + 2, s2.length);
            }
            return s2;
        }

        function urlEncode(strInput) {
            var str = strInput.replace(/(script)/g, '');
            str = str.replace(/(javascript)/g, '');
            str = str.replace(/(alert)/g, '');
            str = str.replace(/(style)/g, '');
            str = str.replace(/(<)/g, '');
            str = str.replace(/(>)/g, '');
            str = strReplace(str, '/', '');
            var Sys = {};
            var ua = (navigator && navigator.userAgent.toLowerCase()) || 'chrome';
            var s;
            (s = ua.match(/msie ([\d.]+)/))
                ? (Sys.ie = s[1])
                : (s = ua.match(/firefox\/([\d.]+)/))
                ? (Sys.firefox = s[1])
                : (s = ua.match(/chrome\/([\d.]+)/))
                ? (Sys.chrome = s[1])
                : (s = ua.match(/opera.([\d.]+)/))
                ? (Sys.opera = s[1])
                : (s = ua.match(/version\/([\d.]+).*safari/))
                ? (Sys.safari = s[1])
                : 0;

            if (Sys.firefox || Sys.chrome) {
                return urlEncodeV2(str);
            }
            if (strInput) {
                if (window && window.execScript) {
                    str = str.replace(/./g, function (sHex) {
                        window.EnCodeStr = '';
                        window.sHex = sHex;
                        window.execScript('window.EnCodeStr=Hex(Asc(window.sHex))', 'vbscript');
                        return window.EnCodeStr.replace(/../g, '%$&');
                    });
                }
                return str;
            } else {
                return '';
            }
        }

        function urlEncodeV2(str) {
            var ret = '';
            var strSpecial = '!"#$%&\'()*+,/:;<=>?[]^`{|}~%';

            for (var i = 0; i < str.length; i++) {
                var chr = str.charAt(i);
                var c = strToAsc(chr);
                var tt = '';
                tt += chr + ':' + c + 'n';
                if (parseInt('0x' + c) > 0x7f) {
                    ret += c.slice(0, 2) + c.slice(-2);
                } else {
                    if (parseInt('0x' + c) < 0x10) {
                        ret += '0' + c.toString(16);
                    } else {
                        ret += c.toString(16);
                    }
                }
            }
            return ret;
        }

        function urlDecodeV2(str) {
            var ret = '';
            for (var i = 0; i < str.length; i++) {
                var chr = str.charAt(i);
                if (chr == '+') {
                    ret += '';
                } else if (chr == '%') {
                    var asc = str.substring(i + 1, i + 3);
                    if (parseInt('0x' + asc) > 0x7f) {
                        ret += ascToStr(parseInt('0x' + asc + str.substring(i + 4, i + 6)));
                        i += 5;
                    } else {
                        ret += ascToStr(parseInt('0x' + asc));
                        i += 2;
                    }
                } else {
                    ret += chr;
                }
            }
            return ret;
        }

        function strToAsc(str) {
            var n = unicodeToAnsi(str.charCodeAt(0));
            var s = n.toString(16);
            return s.toUpperCase();
        }

        function ascToStr(code) {
            var n = ansiToUnicode(code);
            return String.fromCharCode(n);
        }

        function unicodeToAnsi(chrCode) {
            var chrHex = chrCode.toString(16);
            chrHex = '000' + chrHex.toUpperCase();
            chrHex = chrHex.substr(chrHex.length - 4);
            var i = getUniCode().indexOf(chrHex);
            if (i != -1) {
                chrHex = getAnsiCodeChr().substr(i, 4);
            }
            return parseInt(chrHex, 16);
        }

        function ansiToUnicode(chrCode) {
            var chrHex = chrCode.toString(16);
            chrHex = '000' + chrHex.toUpperCase();
            chrHex = chrHex.substr(chrHex.length - 4);
            var i = getAnsiCodeChr().indexOf(chrHex);
            if (i != -1) {
                chrHex = getUniCode().substr(i, 4);
            }
        }

        // ç•™ç©ºçš„å‡½æ•°ï¼Œç”¨æˆ·è‡ªå·±ç¼–è¾‘
        function getChineseCode() {
            // ç”¨æˆ·è‡ªå·±ç¼–è¾‘æ­¤å‡½æ•°
            return '';
        }

        function getUniCode() {
            // ç”¨æˆ·è‡ªå·±ç¼–è¾‘æ­¤å‡½æ•°
            return '';
        }

        function getAnsiCodeChr() {
            // ç”¨æˆ·è‡ªå·±ç¼–è¾‘æ­¤å‡½æ•°
            return '';
        }

        // é‡ç½®å˜é‡å‡½æ•°
        function resetVariables() {
            gattServer = null;
            epdService = null;
            epdCharacteristic = null;
            rxtxCharacteristic = null;
            rxtxService = null;
            document.getElementById("log").value = '';
        }

        // é”™è¯¯å¤„ç†å‡½æ•°
        async function handleError(error) {
            console.log(error);
            resetVariables();
            if (bleDevice == null)
                return;
            if (reconnectTrys <= 5) {
                reconnectTrys++;
                await connect();
            }
            else {
                addLog("Was not able to connect, aborting");
                reconnectTrys = 0;
            }
        }

        // å‘é€EPDå‘½ä»¤
        async function sendCommand(cmd) {
            if (epdCharacteristic) {
                await epdCharacteristic.writeValueWithResponse(cmd)
            } else {
                addLog('æœåŠ¡ä¸å¯ç”¨ã€‚è“ç‰™è¿æ¥ä¸Šäº†å—ï¼Ÿ')
            }
        }

        // å‘é€RXTXå‘½ä»¤
        async function rxTxSendCommand(cmd) {
            if (rxtxCharacteristic) {
                await rxtxCharacteristic.writeValueWithResponse(cmd);
            } else {
                addLog('æœåŠ¡ä¸å¯ç”¨ã€‚è“ç‰™è¿æ¥ä¸Šäº†å—ï¼Ÿ')
            }
        }

        // æ–­å¼€è¿æ¥
        function disconnect() {
            resetVariables();
            addLog('è¿æ¥å·²æ–­å¼€.');
            document.getElementById("connectbutton").innerHTML = 'è¿æ¥è®¾å¤‡';
            const statusIndicator = document.querySelector('.status-indicator');
            statusIndicator.classList.remove('connected');
        }

        // è“ç‰™è¿æ¥ç›¸å…³å‡½æ•°
        async function preConnect() {
            const connectBtn = document.getElementById('connectbutton');
            const statusIndicator = document.querySelector('.status-indicator');
            
            if (gattServer != null && gattServer.connected) {
                if (bleDevice != null && bleDevice.gatt.connected)
                    bleDevice.gatt.disconnect();
            }
            else {
                connectBtn.innerHTML = '<div class="loading"></div>æ­£åœ¨è¿æ¥...';
                connectBtn.disabled = true;
                
                try {
                    reconnectTrys = 0;
                    bleDevice = await navigator.bluetooth.requestDevice({
                        filters: [
                            { namePrefix: "NRF" },
                        ],
                        optionalServices: ['0000221f-0000-1000-8000-00805f9b34fb', '00001f10-0000-1000-8000-00805f9b34fb', '13187b10-eba9-a3ba-044e-83d3217d9a38'],
                        acceptAllDevices: false
                    });
                    await bleDevice.addEventListener('gattserverdisconnected', disconnect);
                    await connect();
                    
                    statusIndicator.classList.add('connected');
                    connectBtn.innerHTML = 'æ–­å¼€';
                    connectBtn.disabled = false;
                    addLog('âœ“ è“ç‰™è¿æ¥æˆåŠŸ');
                } catch (error) {
                    connectBtn.innerHTML = 'è¿æ¥è®¾å¤‡';
                    connectBtn.disabled = false;
                    addLog('âœ— è¿æ¥å¤±è´¥: ' + error.message);
                    await handleError(error);
                }
            }
        }

        async function connectRXTX() {
            rxtxService = await gattServer.getPrimaryService('00001f10-0000-1000-8000-00805f9b34fb');
            addLog('> æ‰¾åˆ°ä¸²å£æœåŠ¡');

            rxtxCharacteristic = await rxtxService.getCharacteristic('00001f1f-0000-1000-8000-00805f9b34fb');
            addLog('> ä¸²å£æœåŠ¡å·²è¿æ¥');
        }

        async function connect() {
            if (epdCharacteristic == null) {
                addLog("æ­£åœ¨è¿æ¥: " + bleDevice.name);

                gattServer = await bleDevice.gatt.connect();
                addLog('> æ‰¾åˆ°GATTæœåŠ¡å™¨');

                epdService = await gattServer.getPrimaryService('13187b10-eba9-a3ba-044e-83d3217d9a38');
                addLog('> æ‰¾åˆ°å¯ç”¨æœåŠ¡');

                epdCharacteristic = await epdService.getCharacteristic('4b646063-6264-f3a7-8941-e65356ea82fe');
                addLog('> æœåŠ¡å·²è¿æ¥');

                await epdCharacteristic.startNotifications();

                document.getElementById("connectbutton").innerHTML = 'æ–­å¼€';
                await connectRXTX();
            }
        }

        async function reConnect() {
            connectTrys = 0;
            if (bleDevice != null && bleDevice.gatt.connected)
                bleDevice.gatt.disconnect();
            resetVariables();
            addLog("é‡æ–°è¿æ¥");
            setTimeout(async function () { await connect(); }, 300);
        }

        function addLog(message) {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            log.value += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }

        // æŒ‡ä»¤å‘é€å‡½æ•°
        async function triggerRxTxCmd(cmd) {
            addLog(`å‘é€æŒ‡ä»¤: ${cmd}`)
            await rxTxSendCommand(hexToBytes(cmd));
        }

        async function triggerShowCmd(cmd) {
            await triggerRxTxCmd(cmd);
            await delay(150);
            await triggerRxTxCmd('e2');
        }

        async function triggerEpdCmd(cmd) {
            addLog(`å‘é€æŒ‡ä»¤: ${cmd}`)
            await sendCommand(hexToBytes(cmd));
        }

        async function setTime() {
            const { unixNow, localeTimeString, year, month, day, week } = getUnixTime();

            addLog("æ—¶é—´è®¾ç½®ä¸º: " + localeTimeString + " : dd" + intToHex(unixNow, 4));
            await rxTxSendCommand(hexToBytes('dd' +
                [intToHex(unixNow, 4), intToHex(year, 2), intToHex(month, 1), intToHex(day, 1), intToHex(week, 1)].join('')));

            await delay(150);
            await rxTxSendCommand(hexToBytes('e2'))
        }

        async function ModifyTimeZone() {
            let timezone = document.getElementById('timezone').value;
            let timezone_hex = intToHex(parseInt(timezone), 1);
            addLog(`ä¿®æ”¹æ—¶åŒºä¸º: ${timezone_hex}`);
            await rxTxSendCommand(hexToBytes('e4' + timezone_hex));
            await delay(150);
            await rxTxSendCommand(hexToBytes('e2'));
        }

        async function dev_reg() {
            const regCode = document.getElementById('reg_code').value;
            if (!regCode) {
                alert('è¯·è¾“å…¥æ¿€æ´»ç ');
                return;
            }
            // è¿™é‡Œéœ€è¦æ ¹æ®å®é™…åè®®å®ç°æ¿€æ´»é€»è¾‘
            addLog(`â†’ è®¾å¤‡æ¿€æ´»: ${regCode}`);
        }

        function getUnixTime() {
            const unixNow = Math.round(Date.now() / 1000) - new Date().getTimezoneOffset() * 60;
            const date = new Date((unixNow + new Date().getTimezoneOffset() * 60) * 1000);
            const localeTimeString = date.toLocaleTimeString();

            return {
                unixNow,
                localeTimeString,
                year: date.getFullYear(),
                month: date.getMonth() + 1,
                day: date.getDate(),
                week: date.getDay() || 7
            }
        }

        // å›¾ç‰‡å¤„ç†å‡½æ•°
        async function update_image() {
            const image_file = document.getElementById('image_file');
            if (image_file.files.length > 0) {
                const file = image_file.files[0];

                const canvas = document.getElementById("canvas");
                const ctx = canvas.getContext("2d");

                const image = new Image();
                image.src = URL.createObjectURL(file);
                image.onload = function(event) {
                    URL.revokeObjectURL(this.src);
                    ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);
                    convert_dithering();
                    addLog('âœ“ å›¾ç‰‡åŠ è½½å®Œæˆ');
                }
            }
        }

        function get_position(canvas, x, y) {
            let rect = canvas.getBoundingClientRect()
            return {
                x: x - rect.left * (canvas.width / rect.width),
                y: y - rect.top * (canvas.height / rect.height)
            }
        }

        function clear_canvas() {
            if (confirm('ç¡®è®¤æ¸…é™¤ç”»å¸ƒå†…å®¹ï¼Ÿ')) {
                const canvas = document.getElementById('canvas');
                const ctx = canvas.getContext("2d");
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                addLog('âœ“ ç”»å¸ƒå·²æ¸…ç©º');
            }
        }

        function convert_dithering() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext("2d");
            const mode = document.getElementById('dithering').value;
            if (mode.startsWith('bwr')) {
                ditheringCanvasByPalette(canvas, bwrPalette, mode);
            } else {
                dithering(ctx, canvas.width, canvas.height, parseInt(document.getElementById('threshold').value), mode);
            }
            addLog('âœ“ å›¾åƒæŠ–åŠ¨å¤„ç†å®Œæˆ');
        }

        // å‘é€å›¾ç‰‡æ•°æ®
        async function sendBufferData(value, type) {
            addLog(`å¼€å§‹å‘é€å›¾ç‰‡æ¨¡å¼:${type}, å¤§å° ${value.length/2/1024}KB`);
            let code = 'ff';
            if (type === 'bwr') {
                code = '00';
            }
            const step = 480;
            let partIndex = 0;
            for (let i = 0; i < value.length; i += step) {
                addLog(`æ­£åœ¨å‘é€ç¬¬${partIndex+1}å—. å—å¤§å°: ${step/2 + 4}byte. èµ·å§‹ä½ç½®: ${i/2}`);
                await sendCommand(hexToBytes("03" + code + intToHex(i / 2, 2) + value.substring(i, i + step)));
                partIndex += 1;
            }
        }

        async function upload_image() {
            const canvas = document.getElementById('canvas');
            const startTime = new Date().getTime();
            let image_id = document.getElementById('image_id').value;

            await sendCommand(hexToBytes("80"+image_id));
            await sendCommand(hexToBytes("0000"));
            await sendCommand(hexToBytes("020000"));
            await sendBufferData(bytesToHex(canvas2bytes(canvas)), 'bw')

            await sendCommand(hexToBytes("0101"))

            addLog(`åˆ·æ–°å®Œæˆï¼Œè€—æ—¶${(new Date().getTime() - startTime)/1000}s`);
        }

        async function channel_image() {
            let image_id = document.getElementById('image_id').value;
            await triggerRxTxCmd(encodeToGb2312('$'+'IMG('+image_id+',0)'));
            await rxTxSendCommand(hexToBytes("E2"));
        }

        function stringToBytes(val) {
            const result = [];
            let t;
            for (let i = 0; i < val.length; i++) {
                t = val.charCodeAt(i);
                result.push(t);
            }
            return result;
        }

        async function show_setting(set_cmd) {
            set_cmds = set_cmd.split("\n");

            let str="";
            let flag=0;
            for(let i=0;i<set_cmds.length;i++) {
                let cmd = set_cmds[i];
                str+=cmd+"\n";
                if(str.length>100||i==set_cmds.length-1) {
                    if(flag==0) {
                        await triggerRxTxCmd(encodeToGb2312('$'+str));
                        str="";
                        flag=1;
                    }
                    else {
                        await triggerRxTxCmd(encodeToGb2312('@'+str));
                        str="";
                    }
                }
            }
            await triggerRxTxCmd("E2");
        }

        // é¡µé¢åˆå§‹åŒ–
        document.body.onload = () => {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext("2d");
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            let is_allow_drawing = false;
            let is_allow_move_editor = false;
            const image_mode = document.getElementById('canvas-mode');
            const paint_size = document.getElementById('paint-size');
            const paint_color = document.getElementById('paint-color');
            const editor = document.getElementById('edit-font');
            const font = document.getElementById('font');
            
            document.getElementById('dithering').value = 'Atkinson';
            image_mode.value = 'paint';
            paint_color.value = 'black';
            font.value = 'é»‘ä½“';

            // æ–‡æœ¬ç¼–è¾‘å™¨äº‹ä»¶
            editor.onmousemove = function (e) {
                editor.style.fontSize = `${paint_size.value * 10}px`;
                editor.style.color = paint_color.value;
                editor.style.fontFamily = font.value;
                editor.style.fontWeight = 'bold';

                if (is_allow_move_editor) {
                    const {x, y} = get_position(canvas, e.clientX, e.clientY);
                    if (x < 0 || y < 0 || x > canvas.width || y > canvas.height) {
                        return;
                    }

                    editor.style.left = `${e.clientX-20}px`;
                    editor.style.top = `${e.clientY-20}px`;
                }
            }

            editor.onmousedown = function (e) {
                is_allow_move_editor = true;
            }

            editor.onmouseup = function (e) {
                is_allow_move_editor = false;
            }

            document.getElementById('update-text').onclick = function () {
                if (!editor.value.length) {
                    alert('è¯·å…ˆè¾“å…¥æ–‡å­—å†…å®¹');
                    return;
                }
                editor.style.display = 'none';
                ctx.beginPath();
                ctx.font = `bold ${paint_size.value * 10}px ${font.value}`;
                ctx.fillStyle = paint_color.value;
                const {x, y} = get_position(canvas, parseInt(editor.style.left), parseInt(editor.style.top) + paint_size.value * 10);

                ctx.fillText(editor.value, x, y);
                addLog('âœ“ æ–‡å­—å·²æ·»åŠ åˆ°ç”»å¸ƒ');
            }

            // æ¨¡å¼åˆ‡æ¢äº‹ä»¶
            image_mode.onchange = function (e) {
                if (image_mode.value === 'font') {
                    document.getElementById('update-text').style.display = 'inline-block';
                    document.getElementById('font').style.display = 'inline-block';

                    editor.style.display = 'block';
                    editor.style.left = `${e.clientX}px`;
                    editor.style.top = `${e.clientY}px`;
                    return;
                }
                document.getElementById('update-text').style.display = 'none';
                document.getElementById('font').style.display = 'none';
                editor.style.display = 'none';
            }

            paint_size.onchange = function () {
                if (image_mode.value === 'font') {
                    editor.style.fontSize = `${paint_size.value * 10}px`;
                }
            }

            paint_color.onchange = function () {
                if (image_mode.value === 'font') {
                    editor.style.color = paint_color.value;
                }
            }

            font.onchange = function () {
                if (image_mode.value === 'font') {
                    editor.style.fontFamily = font.value;
                }
            }

            // ç”»å¸ƒç»˜åˆ¶äº‹ä»¶
            canvas.onmousedown = function(e) {
                let ele = get_position(canvas, e.clientX, e.clientY)
                let { x, y } = ele

                switch (image_mode.value) {
                    case 'paint':
                        is_allow_drawing = true;
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        break;
                    case 'font':
                        editor.style.display = 'block';
                        editor.style.left = `${e.clientX}px`;
                        editor.style.top = `${e.clientY}px`;
                        editor.style.fontSize = `${paint_size.value * 10}px`;
                        editor.style.color = paint_color.value;
                        editor.style.fontFamily = font.value;
                        editor.style.fontWeight = 'bold';
                        break
                    default:
                        break;
                }
            };

            canvas.onmousemove = (e) => {
                let ele = get_position(canvas, e.clientX, e.clientY)
                let { x, y } = ele;
                switch (image_mode.value) {
                    case 'paint':
                        if (is_allow_drawing) {
                            ctx.lineWidth = paint_size.value;
                            ctx.strokeStyle = paint_color.value;
                            ctx.lineTo(x, y);
                            ctx.stroke();
                        }
                        break;
                    case 'font':
                        break;
                    default:
                        break;
                }
            }

            canvas.onmouseup = function() {
                switch (image_mode.value) {
                    case 'paint':
                        is_allow_drawing = false;
                        break;
                    case 'font':
                        editor.focus();
                        is_allow_move_editor = false;
                        break;
                    default:
                        break;
                }
            }

            canvas.onmouseleave = function () {
                if (image_mode.value === 'paint') {
                    is_allow_drawing = false;
                }
            }

            addLog('âœ“ ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showContent(contentId) {
            const contents = document.querySelectorAll('.content');
            contents.forEach(content => content.classList.remove('active'));

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(contentId).classList.add('active');

            const activeTab = tabs[contentId.replace('content', '') - 1];
            activeTab.classList.add('active');
        }
    </script>

    <div class="container">
        <div class="header">
            <h1>ğŸ·ï¸ æ™ºèƒ½ç”µå­ä»·ç­¾è“ç‰™æ§åˆ¶ä¸­å¿ƒ</h1>
            <p>ä¸“ä¸šçš„ç”µå­ä»·ç­¾ç®¡ç†ç³»ç»Ÿ - æ”¯æŒ2.13è‹±å¯¸ä»·ç­¾ (åˆ†è¾¨ç‡: 104Ã—212 å’Œ 122Ã—250)</p>
        </div>

        <div class="connection-panel">
            <div class="connection-buttons">
                <button id="connectbutton" class="btn btn-success" onclick="preConnect();">
                    <span class="status-indicator"></span>è¿æ¥è®¾å¤‡
                </button>
                <button class="btn btn-warning" onclick="reConnect();">ğŸ”„ é‡æ–°è¿æ¥</button>
                <button class="btn btn-info" onclick="document.getElementById('log').value = '';">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
            </div>
        </div>

        <div class="tabs">
            <div class="tab" onclick="showContent('content1')">âš™ï¸ åŸºç¡€æ§åˆ¶</div>
            <div class="tab active" onclick="showContent('content2')">ğŸ–¼ï¸ å›¾åƒå¤„ç†</div>
            <div class="tab" onclick="showContent('content3')">ğŸ”§ é«˜çº§è®¾ç½®</div>
        </div>

        <div id="content1" class="content">
            <div class="feature-grid">
                <div class="card">
                    <div class="card-title">ğŸ“¡ æŒ‡ä»¤æ§åˆ¶</div>
                    <div class="form-group">
                        <label class="form-label">è‡ªå®šä¹‰æŒ‡ä»¤</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="cmdTXT" value="E2" class="form-control" placeholder="è¾“å…¥æŒ‡ä»¤ä»£ç ">
                            <button class="btn" onclick="triggerRxTxCmd(document.getElementById('cmdTXT').value);">å‘é€</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ® å¿«æ·æ“ä½œ</div>
                    <div class="button-group">
                        <button class="btn tooltip" onclick="triggerShowCmd('e100')" data-tooltip="æ˜¾ç¤ºä¸Šä¼ çš„å›¾ç‰‡">ğŸ“· å›¾ç‰‡æ¨¡å¼</button>
                        <button class="btn tooltip" onclick="triggerShowCmd('e101')" data-tooltip="æ˜¾ç¤ºæ—¥å†ç•Œé¢">ğŸ“… æ—¥å†æ¨¡å¼</button>
                        <button class="btn tooltip" onclick="triggerShowCmd('e102')" data-tooltip="æ˜¾ç¤ºæ—¶é’Ÿç•Œé¢">ğŸ• æ—¶é’Ÿæ¨¡å¼</button>
                        <button class="btn tooltip" onclick="triggerShowCmd('e103')" data-tooltip="è‡ªå®šä¹‰æ˜¾ç¤ºæ¨¡å¼">âš¡ è‡ªå®šä¹‰æ¨¡å¼</button>
                    </div>
                    <div class="button-group">
                        <button class="btn tooltip" onclick="triggerRxTxCmd('e2')" data-tooltip="åˆ·æ–°å±å¹•æ˜¾ç¤º">ğŸ”„ åˆ·æ–°å±å¹•</button>
                        <button class="btn tooltip" onclick="triggerRxTxCmd('E001')" data-tooltip="åˆ‡æ¢æ˜¾ç¤ºå±å¹•">ğŸ”€ åˆ‡æ¢å±å¹•</button>
                        <button class="btn tooltip" onclick="triggerRxTxCmd('e3')" data-tooltip="é»‘ç™½åè‰²æ˜¾ç¤º">ğŸ”„ åè‰²æ˜¾ç¤º</button>
                        <button class="btn tooltip" onclick="setTime()" data-tooltip="åŒæ­¥ç³»ç»Ÿæ—¶é—´">â° åŒæ­¥æ—¶é—´</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸŒ æ—¶åŒºè®¾ç½®</div>
                    <div class="form-group">
                        <label class="form-label">é€‰æ‹©æ—¶åŒº</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <select id="timezone" class="form-control form-control-inline">
                                <option value="-12">UTC-12</option>
                                <option value="-11">UTC-11</option>
                                <option value="-10">UTC-10</option>
                                <option value="-9">UTC-9</option>
                                <option value="-8">UTC-8</option>
                                <option value="-7">UTC-7</option>
                                <option value="-6">UTC-6</option>
                                <option value="-5">UTC-5</option>
                                <option value="-4">UTC-4</option>
                                <option value="-3">UTC-3</option>
                                <option value="-2">UTC-2</option>
                                <option value="-1">UTC-1</option>
                                <option value="0">UTC+0</option>
                                <option value="1">UTC+1</option>
                                <option value="2">UTC+2</option>
                                <option value="3">UTC+3</option>
                                <option value="4">UTC+4</option>
                                <option value="5">UTC+5</option>
                                <option value="6">UTC+6</option>
                                <option value="7">UTC+7</option>
                                <option value="8" selected="selected">UTC+8 (åŒ—äº¬æ—¶é—´)</option>
                                <option value="9">UTC+9</option>
                                <option value="10">UTC+10</option>
                                <option value="11">UTC+11</option>
                                <option value="12">UTC+12</option>
                            </select>
                            <button class="btn" onclick="ModifyTimeZone()">åº”ç”¨æ—¶åŒº</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ”‘ è®¾å¤‡æ¿€æ´»</div>
                    <div class="form-group">
                        <label class="form-label">æ¿€æ´»ç </label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="reg_code" class="form-control" placeholder="è¯·è¾“å…¥è®¾å¤‡æ¿€æ´»ç ">
                            <button class="btn" onclick="dev_reg()">æ¿€æ´»è®¾å¤‡</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="content2" class="content active">
            <div class="feature-grid">
                <div class="card">
                    <div class="card-title">ğŸ“ å›¾ç‰‡ä¸Šä¼ </div>
                    <div class="form-group">
                        <label class="form-label">é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</label>
                        <input type="file" id="image_file" onchange="update_image()" accept=".png,.jpg,.bmp,.webp" class="form-control">
                        <small style="color: #666; margin-top: 5px; display: block;">æ”¯æŒ PNGã€JPGã€BMPã€WebP æ ¼å¼</small>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ¨ å›¾åƒå¤„ç†</div>
                    <div class="form-group">
                        <label class="form-label">æŠ–åŠ¨ç®—æ³•</label>
                        <select id="dithering" class="form-control">
                            <optgroup label="é»‘ç™½å¤„ç†">
                                <option value="none">äºŒå€¼åŒ–å¤„ç†</option>
                                <option value="bayer">Bayer æŠ–åŠ¨</option>
                                <option value="floydsteinberg">Floyd-Steinberg æŠ–åŠ¨</option>
                                <option value="Atkinson" selected="selected">Atkinson æŠ–åŠ¨ (æ¨è)</option>
                            </optgroup>
                            <optgroup label="ä¸‰è‰²å¤„ç† (é»‘ç™½çº¢)">
                                <option value="bwr_floydsteinberg">ä¸‰è‰² Floyd-Steinberg</option>
                                <option value="bwr_Atkinson">ä¸‰è‰² Atkinson</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">äºŒå€¼åŒ–é˜ˆå€¼ (0-255)</label>
                        <input type="number" max="255" min="0" value="125" id="threshold" class="form-control">
                    </div>
                    <div class="button-group">
                        <button class="btn" onclick="update_image()">ğŸ”„ é‡æ–°å¤„ç†</button>
                        <button class="btn btn-warning" onclick="clear_canvas()">ğŸ—‘ï¸ æ¸…ç©ºç”»å¸ƒ</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">âœï¸ ç»˜å›¾å·¥å…·</div>
                    <div class="form-group">
                        <label class="form-label">ç»˜å›¾æ¨¡å¼</label>
                        <select id="canvas-mode" class="form-control">
                            <option value="paint" selected="selected">ğŸ–Œï¸ ç”»ç¬”ç»˜åˆ¶</option>
                            <option value="font">ğŸ“ æ–‡å­—è¾“å…¥</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">ç”»ç¬”/æ–‡å­—å¤§å°</label>
                            <input type="number" max="13" min="1" step="1" value="3" id="paint-size" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é¢œè‰²é€‰æ‹©</label>
                            <select id="paint-color" class="form-control">
                                <option value="white">âšª ç™½è‰²</option>
                                <option value="black" selected="selected">âš« é»‘è‰²</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å­—ä½“é€‰æ‹©</label>
                        <select id="font" class="form-control" style="display: none;">
                            <option value="å¾®è½¯é›…é»‘">å¾®è½¯é›…é»‘</option>
                            <option value="é»‘ä½“" selected="selected">é»‘ä½“</option>
                            <option value="ä»¿å®‹">ä»¿å®‹</option>
                            <option value="å®‹ä½“">å®‹ä½“</option>
                            <option value="æ¥·ä½“_GB2312">æ¥·ä½“</option>
                            <option value="åæ–‡è¡Œæ¥·">åæ–‡è¡Œæ¥·</option>
                        </select>
                        <button id="update-text" class="btn" style="display: none">ğŸ’¾ ä¿å­˜æ–‡å­—</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ–¼ï¸ ç”»å¸ƒé¢„è§ˆ</div>
                    <div class="canvas-container">
                        <input id="edit-font" placeholder="è¾“å…¥æ–‡å­—å†…å®¹...">
                        <canvas id="canvas" width="250" height="122"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ğŸ“¤ å›¾ç‰‡ç®¡ç†</div>
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">å›¾ç‰‡æ§½ä½</label>
                            <select id="image_id" class="form-control form-control-inline">
                                <option value="0" selected="selected">ğŸ“· å›¾ç‰‡æ§½ 1</option>
                                <option value="1">ğŸ“· å›¾ç‰‡æ§½ 2</option>
                                <option value="2">ğŸ“· å›¾ç‰‡æ§½ 3</option>
                                <option value="3">ğŸ“· å›¾ç‰‡æ§½ 4</option>
                                <option value="4">ğŸ“· å›¾ç‰‡æ§½ 5</option>
                                <option value="5">ğŸ“· å›¾ç‰‡æ§½ 6</option>
                                <option value="6">ğŸ“· å›¾ç‰‡æ§½ 7</option>
                                <option value="7">ğŸ“· å›¾ç‰‡æ§½ 8</option>
                            </select>
                        </div>
                        <div class="button-group" style="margin-bottom: 0;">
                            <button class="btn btn-info" onclick="channel_image()">ğŸ‘ï¸ æ˜¾ç¤ºå›¾ç‰‡</button>
                            <button class="btn btn-success" onclick="upload_image()">ğŸ“¤ ä¸Šä¼ åˆ°è®¾å¤‡</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="content3" class="content">
            <div class="card">
                <div class="card-title">âš™ï¸ é«˜çº§æ˜¾ç¤ºè®¾ç½®</div>
                <div class="form-group">
                    <label class="form-label">è‡ªå®šä¹‰æ˜¾ç¤ºå‘½ä»¤</label>
                    <textarea id="show_setting_cmd" class="form-control" rows="10" placeholder="è¾“å…¥æ˜¾ç¤ºè®¾ç½®å‘½ä»¤...">RECT(0,0,140,18,0,1,1)
FONT(5,1,4,1,1,0,'æ—¥ä¸€äºŒä¸‰å››äº”å…­')
FONT(5,20,8,0,0,1,'{CAL}')
FONT(150,2,2,1,0,1,'{y}')
FONT(150,22,0,2,0,1,'{m}')
FONT(150,72,0,1,0,1,'{H}:{N}')
FONT(150,90,0,0,0,1,'{c}')
FONT(192,90,0,0,0,1,'{b}%')
FONT(5,92,0,0,0,1,'{VER}')</textarea>
                    <small style="color: #666; margin-top: 5px; display: block;">
                        å‘½ä»¤æ ¼å¼è¯´æ˜ï¼š<br>
                        â€¢ RECT(x,y,w,h,fill,border,color) - ç»˜åˆ¶çŸ©å½¢<br>
                        â€¢ FONT(x,y,size,bold,italic,color,'text') - æ˜¾ç¤ºæ–‡å­—<br>
                        â€¢ å˜é‡: {CAL}æ—¥å† {y}å¹´ {m}æœˆ {H}æ—¶ {N}åˆ† {c}æ¸©åº¦ {b}ç”µé‡ {VER}ç‰ˆæœ¬
                    </small>
                </div>
                <button class="btn btn-success" onclick="show_setting(document.getElementById('show_setting_cmd').value)">
                    ğŸš€ åº”ç”¨æ˜¾ç¤ºè®¾ç½®
                </button>
            </div>
        </div>

        <div class="log-container">
            <div class="log-header">
                ğŸ“‹ ç³»ç»Ÿæ—¥å¿—
            </div>
            <textarea id="log" readonly placeholder="ç³»ç»Ÿæ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º..."></textarea>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // é»˜è®¤æ˜¾ç¤ºå›¾åƒå¤„ç†æ ‡ç­¾é¡µ
            showContent('content2');
        });
    </script>
</body>
</html>